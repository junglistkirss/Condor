namespace Condor.Visitor.Generator
{
    internal static class DefaultTemplates
    {
        internal const string VisitorTemplate = @"// <auto-generated>
{{#*inline ""LowResponse""}}
{{~#if IsAsync}}{{~#if HasReturnType}}ValueTask<{{{ReturnType}}}>{{~else~}}ValueTask{{/if~}}{{else}}{{~#if HasReturnType}}{{{ReturnType}}}{{~else~}}void{{/if~}}{{/if~}}
{{/inline}}
{{#*inline ""Response""}}
{{~#if ../IsAsync}}{{~#if ../HasReturnType}}ValueTask<{{{../ReturnType}}}>{{~else~}}ValueTask{{/if~}}{{else}}{{~#if ../HasReturnType}}{{{../ReturnType}}}{{~else~}}void{{/if~}}{{/if~}}
{{/inline}}
{{#*inline ""ResponseNested""}}
{{~#if ../../IsAsync}}{{~#if ../../HasReturnType}}ValueTask<{{{../../ReturnType}}}>{{~else~}}ValueTask{{/if~}}{{else}}{{~#if ../../HasReturnType}}{{{ ../../ReturnType}}}{{~else~}}void{{/if~}}{{/if~}}
{{/inline}}
{{#*inline ""VisitOptionsClass""}}
    {{#each ImplementationGroup}}
        {{#if AddVisitFallBack}}
        public partial {{>Response}} VisitFallBack({{{VisitedType.TypeFullName}}} element{{#each ../TypedArgs}}, {{{ParamTypeFullName}}} {{SanitizedParamName}}{{/each}});
        {{/if}}
        {{#if AddVisitRedirect}}
        public virtual {{>Response}} VisitRedirect({{{VisitedType.TypeFullName}}} element{{#each ../TypedArgs}}, {{{ParamTypeFullName}}} {{SanitizedParamName}}{{/each}})
        {
            switch (element)
            {
                {{#each ImplementationTypes}}
                case {{{ParamTypeFullName}}} x:
                    {{#if ../../HasReturnType}} 
                    return Visit(x{{#each ../../TypedArgs}}, {{SanitizedParamName}}{{/each}});
                    {{else}}
                    {{#if ../IsAsync}}
                    return Visit(x{{#each ../../TypedArgs}}, {{SanitizedParamName}}{{/each}});
                    {{else}}
                    Visit(x{{#each ../../TypedArgs}}, {{SanitizedParamName}}{{/each}});
                    break;
                    {{/if}}
                    {{/if}}
                {{/each}}
                default:
                    {{#if AddVisitFallBack}}
                    return VisitFallBack(element{{#each ../TypedArgs}}, {{SanitizedParamName}}{{/each}});
                    {{else}}
                    throw new System.NotSupportedException(""Unsupported type"");
                    {{/if}}
            }
        }
        {{/if}}
        {{#each ImplementationTypes}}
        public partial {{>ResponseNested}} Visit({{{TypeFullName}}} element{{#each ../../TypedArgs}}, {{{ParamTypeFullName}}} {{SanitizedParamName}}{{/each}});
        {{/each}}
    {{/each}}
{{/inline}}
{{#*inline ""VisitOptionsInterface""}}
    {{#each ImplementationGroup}}
        {{#if AddVisitFallBack}}
        {{>Response}} VisitFallBack({{{VisitedType.TypeFullName}}} element{{#each ../TypedArgs}}, {{{ParamTypeFullName}}} {{SanitizedParamName}}{{/each}});
        {{/if}}

        {{#if AddVisitRedirect}}
        {{>Response}} VisitRedirect({{{VisitedType.TypeFullName}}} element{{#each ../TypedArgs}}, {{{ParamTypeFullName}}} {{SanitizedParamName}}{{/each}});
        {{/if}}
        {{#each ImplementationTypes}}
        {{>ResponseNested}} Visit({{{TypeFullName}}} element{{#each ../../TypedArgs}}, {{{ParamTypeFullName}}} {{SanitizedParamName}}{{/each}}{{#each ../Args}}, {{{.}}}{{/each}});
        {{/each}}
    {{/each}}
{{/inline}}

namespace {{OutputNamespace}}
{
    {{AccessibilityModifier}} partial {{{KeywordTypeDefinition}}} {{{OriginalTypeDefinition}}}
    {
        {{#if IsInterface}}
        {{>VisitOptionsInterface}}
        {{else}}
        {{>VisitOptionsClass}}
        {{/if}}
    }

     {{#if Visitable.GenerateVisitable}}
     {{AccessibilityModifier}} partial interface {{{Visitable.VisitableTypeName}}} {
         {{>LowResponse}} Accept{{{GenericTypesDefinition}}}(
             {{BaseTypeDefinition}}{{{GenericTypesDefinition}}} visitor{{#each Visitable.VisitableParameters}}, {{{ParamTypeFullName}}} {{SanitizedParamName}}{{/each}});
     }
     {{/if}}
    
    {{#if Default.GenerateDefault}}
    {{#if Default.ForcePublic}}public {{else}}{{AccessibilityModifier}} {{/if}}{{#if Default.IsAbstract}}abstract {{/if}}{{#if Default.IsPartial}}partial {{/if}}class Default{{Default.DefaultTypeName}}{{{GenericTypesDefinition}}} : {{BaseTypeDefinition}}{{{GenericTypesDefinition}}}
    {
        {{#each ImplementationGroup}}
        {{#each ImplementationTypes}}
        {{#if ../../Default.IsVisitAbstract}}
        public abstract {{>ResponseNested}} Visit({{{TypeFullName}}} element{{#each ../../TypedArgs}}, {{{ParamTypeFullName}}} {{SanitizedParamName}}{{/each}});
        {{else}}
        public virtual {{>ResponseNested}} Visit(
            {{{TypeFullName}}} element{{#each ../../TypedArgs}}, {{{ParamTypeFullName}}} {{SanitizedParamName}}{{/each}})
        {
            {{#if ../../HasReturnType}}   
            {{#if ../../Default.UseVisitFallBack}}
            return VisitFallBack(element{{#each ../../TypedArgs}}, {{SanitizedParamName}}{{/each}});
            {{else}}
            return default!;
            {{/if}}
            {{else}}
            {{#if ../../Default.UseVisitFallBack}}
            VisitFallBack(element{{#each ../../TypedArgs}}, {{SanitizedParamName}}{{/each}});
            {{else}}
            return;
            {{/if}}
            {{/if}}
        }
        {{/if}}
        {{/each}}
        {{/each}}
    }
    {{/if}}

}";
    }
}
