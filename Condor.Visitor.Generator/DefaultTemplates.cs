namespace Condor.Visitor.Generator;

internal static class DefaultTemplates
{
    internal const string DefaultVisitorTemplateKey = "DEFAULT_VISITOR_TEMPLATE";
    internal const string VisitorTemplate = @"// <auto-generated>
{{<LowResponse}}
{{#IsAsync}}{{#HasReturnType}}ValueTask<{{&ReturnType}}>{{/HasReturnType}}{{^HasReturnType}}ValueTask{{/HasReturnType}}{{/IsAsync}}{{^IsAsync}}{{#HasReturnType}}{{&ReturnType}}{{/HasReturnType}}{{^HasReturnType}}void{{/HasReturnType}}{{/IsAsync}}
{{/LowResponse}}
{{<Response}}
{{#IsAsync}}{{#HasReturnType}}ValueTask<{{&ReturnType}}>{{/HasReturnType}}{{^HasReturnType}}ValueTask{{/HasReturnType}}{{/IsAsync}}{{^IsAsync}}{{#HasReturnType}}{{&ReturnType}}{{/HasReturnType}}{{^HasReturnType}}void{{/HasReturnType}}{{/IsAsync}}{{/Response}}
{{<ResponseNested}}
{{#IsAsync}}{{#HasReturnType}}ValueTask<{{&ReturnType}}>{{/HasReturnType}}{{^HasReturnType}}ValueTask{{/HasReturnType}}{{/IsAsync}}{{^IsAsync}}{{#HasReturnType}}{{&ReturnType}}{{/HasReturnType}}{{^HasReturnType}}void{{/HasReturnType}}{{/IsAsync}}
{{/ResponseNested}}
namespace {{&OutputNamespace}}
{
    {{#IsInterface}}
    {{&AccessibilityModifier}} partial interface {{&OriginalTypeDefinition}}
    {
        {{#ImplementationGroup}}
        {{#AddVisitFallback}}
        {{>Response}} {{&VisitMethodName}}Fallback({{&VisitedType.TypeFullName}} element{{#TypedArgs}}, {{&ParamTypeFullName}} {{&SanitizedParamName}}{{/TypedArgs}});
        {{/AddVisitFallback}}
        {{#AddVisitRedirect}}
        {{>Response}} {{&VisitMethodName}}Redirect({{&VisitedType.TypeFullName}} element{{#TypedArgs}}, {{&ParamTypeFullName}} {{&SanitizedParamName}}{{/TypedArgs}});
        {{/AddVisitRedirect}}
        {{#ImplementationTypes}}
        {{>ResponseNested}} {{&VisitMethodName}}({{&TypeFullName}} element{{#TypedArgs}}, {{&ParamTypeFullName}} {{&SanitizedParamName}}{{/TypedArgs}}{{#Args}}, {{&.}}{{/Args}});
        {{/ImplementationTypes}}
        {{/ImplementationGroup}}
    }
    {{/IsInterface}}
    {{^IsInterface}}
    {{&AccessibilityModifier}} partial class {{&OriginalTypeDefinition}}
    {
        {{#ImplementationGroup}}
        {{#AddVisitFallback}}
        public partial {{>Response}} {{&VisitMethodName}}Fallback({{&VisitedType.TypeFullName}} element{{#TypedArgs}}, {{&ParamTypeFullName}} {{&SanitizedParamName}}{{/TypedArgs}});
        {{/AddVisitFallback}}

        {{#AddVisitRedirect}}
        public virtual {{>Response}} {{&VisitMethodName}}Redirect({{&VisitedType.TypeFullName}} element{{#TypedArgs}}, {{&ParamTypeFullName}} {{&SanitizedParamName}}{{/TypedArgs}})
        {
            switch (element)
            {
                {{#ImplementationTypes}}
                case {{&TypeFullName}} x:
                    {{#HasReturnType}} 
                    return {{&VisitMethodName}}(x{{#TypedArgs}}, {{&SanitizedParamName}}{{/TypedArgs}});
                    {{/HasReturnType}}
                    {{^HasReturnType}}
                    {{#IsAsync}}
                    return {{&VisitMethodName}}(x{{#TypedArgs}}, {{&SanitizedParamName}}{{/TypedArgs}});
                    {{/IsAsync}}
                    {{^IsAsync}}
                    {{&VisitMethodName}}(x{{#TypedArgs}}, {{&SanitizedParamName}}{{/TypedArgs}});
                    break;
                    {{/IsAsync}}
                    {{/HasReturnType}}
                {{/ImplementationTypes}}
                default:
                    {{#AddVisitFallback}}
                    {{#HasReturnType}} 
                    return {{&VisitMethodName}}Fallback(element{{#TypedArgs}}, {{&SanitizedParamName}}{{/TypedArgs}});
                    {{/HasReturnType}}
                    {{^HasReturnType}}
                    {{#IsAsync}}
                    return {{&VisitMethodName}}Fallback(element{{#TypedArgs}}, {{&SanitizedParamName}}{{/TypedArgs}});
                    {{/IsAsync}}
                    {{^IsAsync}}
                    {{&VisitMethodName}}Fallback(element{{#TypedArgs}}, {{&SanitizedParamName}}{{/TypedArgs}});
                    break;
                    {{/IsAsync}}
                    {{/HasReturnType}}
                    {{/AddVisitFallback}}
                    {{^AddVisitFallback}}
                    throw new System.NotSupportedException(""Unsupported type"");
                    {{/AddVisitFallback}}
            }
        }
        {{/AddVisitRedirect}}

        {{#ImplementationTypes}}
        public partial {{>ResponseNested}} {{&VisitMethodName}}({{&TypeFullName}} element{{#TypedArgs}}, {{&ParamTypeFullName}} {{&SanitizedParamName}}{{/TypedArgs}});
        {{/ImplementationTypes}}
        {{/ImplementationGroup}}
    }
    {{/IsInterface}}

    {{#Visitable.GenerateVisitable}}
    {{&AccessibilityModifier}} partial interface {{&Visitable.VisitableTypeName}} {
        {{>LowResponse}} {{&Visitable.AcceptMethodName}}{{&GenericTypesDefinition}}({{&BaseTypeDefinition}}{{&GenericTypesDefinition}} visitor{{#Visitable.VisitableParameters}}, {{&ParamTypeFullName}} {{&SanitizedParamName}}{{/Visitable.VisitableParameters}});
    }
    {{/Visitable.GenerateVisitable}}

    {{#Default.GenerateDefault}}
    {{#Default.ForcePublic}}public {{/Default.ForcePublic}}{{^Default.ForcePublic}}{{&AccessibilityModifier}} {{/Default.ForcePublic}}{{#Default.IsAbstract}}abstract {{/Default.IsAbstract}}{{#Default.IsPartial}}partial {{/Default.IsPartial}}class Default{{&Default.DefaultTypeName}}{{&GenericTypesDefinition}} : {{&BaseTypeDefinition}}{{&GenericTypesDefinition}}
    {
        {{#ImplementationGroup}}
        {{#AddVisitFallback}}
        {{#Default.IsAbstract}}
        public abstract {{>Response}} {{&VisitMethodName}}Fallback({{&VisitedType.TypeFullName}} element{{#TypedArgs}}, {{&ParamTypeFullName}} {{&SanitizedParamName}}{{/TypedArgs}});
        {{/Default.IsAbstract}}
        {{^Default.IsAbstract}}
        {{#Default.IsPartial}}
        public partial {{>Response}} {{&VisitMethodName}}Fallback({{&VisitedType.TypeFullName}} element{{#TypedArgs}}, {{&ParamTypeFullName}} {{&SanitizedParamName}}{{/TypedArgs}});
        {{/Default.IsPartial}}
        {{^Default.IsPartial}}
        public virtual {{>Response}} {{&VisitMethodName}}Fallback({{&VisitedType.TypeFullName}} element{{#TypedArgs}}, {{&ParamTypeFullName}} {{&SanitizedParamName}}{{/TypedArgs}})
        {
            throw new System.NotImplementedException();
        }
        {{/Default.IsPartial}}
        {{/Default.IsAbstract}}
        {{/AddVisitFallback}}
        {{#AddVisitRedirect}}
        public virtual {{>Response}} {{&VisitMethodName}}Redirect({{&VisitedType.TypeFullName}} element{{#TypedArgs}}, {{&ParamTypeFullName}} {{&SanitizedParamName}}{{/TypedArgs}})
        {
            switch (element)
            {
                {{#ImplementationTypes}}
                case {{&TypeFullName}} x:
                    {{#HasReturnType}} 
                    return {{&VisitMethodName}}(x{{#TypedArgs}}, {{&SanitizedParamName}}{{/TypedArgs}});
                    {{/HasReturnType}}
                    {{^HasReturnType}}
                    {{#IsAsync}}
                    return {{&VisitMethodName}}(x{{#TypedArgs}}, {{&SanitizedParamName}}{{/TypedArgs}});
                    {{/IsAsync}}
                    {{^IsAsync}}
                    {{&VisitMethodName}}(x{{#TypedArgs}}, {{&SanitizedParamName}}{{/TypedArgs}});
                    break;
                    {{/IsAsync}}
                    {{/HasReturnType}}
                {{/ImplementationTypes}}
                default:
                    {{#AddVisitFallback}}
                    {{#HasReturnType}}
                    return {{&VisitMethodName}}Fallback(element{{#TypedArgs}}, {{&SanitizedParamName}}{{/TypedArgs}});
                    {{/HasReturnType}}
                    {{^HasReturnType}}
                    {{#IsAsync}}
                    return {{&VisitMethodName}}Fallback(element{{#TypedArgs}}, {{&SanitizedParamName}}{{/TypedArgs}});
                    {{/IsAsync}}
                    {{^IsAsync}}
                    {{&VisitMethodName}}Fallback(element{{#TypedArgs}}, {{&SanitizedParamName}}{{/TypedArgs}});
                    break;
                    {{/IsAsync}}
                    {{/HasReturnType}}
                    {{/AddVisitFallback}}
                    {{^AddVisitFallback}}
                    throw new System.NotSupportedException();
                    {{/AddVisitFallback}}
            }
        }
        {{/AddVisitRedirect}}
        {{#ImplementationTypes}}

        {{#Default.IsVisitAbstract}}
        public abstract {{>ResponseNested}} {{&VisitMethodName}}({{&TypeFullName}} element{{#TypedArgs}}, {{&ParamTypeFullName}} {{&SanitizedParamName}}{{/TypedArgs}});
        {{/Default.IsVisitAbstract}}

        {{^Default.IsVisitAbstract}}
        public virtual {{>ResponseNested}} {{&VisitMethodName}}({{&TypeFullName}} element{{#TypedArgs}}, {{&ParamTypeFullName}} {{&SanitizedParamName}}{{/TypedArgs}})
        {
            {{#HasReturnType}}
            {{#AddVisitFallback}}
            return {{&VisitMethodName}}Fallback(element{{#TypedArgs}}, {{&SanitizedParamName}}{{/TypedArgs}});
            {{/AddVisitFallback}}
            {{^AddVisitFallback}}
            return default!;
            {{/AddVisitFallback}}
            {{/HasReturnType}}
            {{^HasReturnType}}
            {{#AddVisitFallback}}
            {{&VisitMethodName}}Fallback(element{{#TypedArgs}}, {{&SanitizedParamName}}{{/TypedArgs}});
            {{/AddVisitFallback}}
            {{^AddVisitFallback}}
            return;
            {{/AddVisitFallback}}
            {{/HasReturnType}}
        }
        {{/Default.IsVisitAbstract}}
        {{/ImplementationTypes}}
    {{/ImplementationGroup}}
    }
    {{/Default.GenerateDefault}}
}";
}
